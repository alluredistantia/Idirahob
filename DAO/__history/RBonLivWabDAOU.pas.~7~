unit RBonLivWabDAOU;

interface
uses RBonLivWebDTOU, System.Generics.Collections;
type RBonLivListDTO=TObjectList<TRBonLivWebDTO>;
type RBonLivWebDAO=class (TObject)
function getNewId:integer;
function save(vRBonLivWebDTO:TRBonLivWebDTO): integer;
function getRBonLivsByBonLiv(vBonLiv:integer): RBonLivListDTO;
function getNbrRBonLivsByBonLiv(vBonLiv:integer): integer;
function getNbr: integer;
end;

implementation

uses
  APIUtilsU, REST.Json, System.SysUtils;

{ TRInventDAO }

function RBonLivWabDAO.getNbrRBonLivsByBonLiv(vBonLiv:integer): integer;
begin
Result:=strtoint(RestReqGet.create(nil,'rinvent/getNbrRInventsByInvent/'+IntToStr(vInvent)).Response.JSONValue.ToString);

end;

function RBonLivWabDAO.getNewId: integer;
begin
Result:=StrToInt(RestReqGet.create(nil,'rinvent/getNewId').Response.JSONValue.ToString);
end;

function RBonLivWabDAO.getRInventsByInvent(vInvent:integer): RInventListDTO;
  var ListRInvent:RInventListDTO;
  oRInventDTO:TRInventDTO;
  i:Integer;
  vNbr:integer;
begin
  vNbr:=self.getNbrRInventsByInvent(vInvent);
  ListRInvent:=TJson.JsonToObject<RInventListDTO>
  ('{"ownsObjects": true,"listHelper": ['+inttostr(vNbr)+'], "items":'+
  RestReqGet.create(nil,'rinvent/getRInventsByInvent/'+IntToStr(vInvent)).Response.JSONValue.ToString+'}');
  result:=ListRInvent;
end;

function RBonLivWabDAO.getNbr: integer;
begin
Result:=strtoint(RestReqGet.create(nil,'rinvent/getNbr').Response.JSONValue.ToString);

end;


function RBonLivWabDAO.save(vRInventDTO:TRInventDTO): integer;
begin
RestReqPost.create(TJson.ObjectToJsonObject(vRInventDTO),
'rinvent/setRInvent');
end;

end.
